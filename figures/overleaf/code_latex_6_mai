\documentclass[12pt]{article}

% Language setting
% Replace `english' with e.g. `spanish' to change the document language
\usepackage[english]{babel}
\usepackage[backend=bibtex,sorting=none]{biblatex}
\addbibresource{biblio.bib}

\usepackage{fontspec}
\setmainfont{Liberation Serif}

% Set page size and margins
% Replace `letterpaper' with `a4paper' for UK/EU standard size
% \usepackage[letterpaper,top=2cm,bottom=2cm,left=3cm,right=3cm,marginparwidth=1.75cm]{geometry}
\usepackage[letterpaper,margin=2cm]{geometry}

\addto{\captionsenglish}{\renewcommand{\abstractname}{Summary}} % to rename the abstract in "Summary"
% Keywords command
\providecommand{\keywords}[1]
{
  \small	
  \textbf{\textit{Keywords---}} #1
}

% Useful packages
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage[colorlinks=true, allcolors=blue]{hyperref}

\usepackage{tikz,tkz-tab} 
\usepackage{amssymb}
\usepackage{lastpage}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancypagestyle{plain}

\usepackage{emptypage}
\fancyhead[L]{UMR AMAP}
\fancyhead[R]{Intership report}
\renewcommand{\footrulewidth}{1pt}
\fancyfoot[L]{Spring, 2024}
\fancyfoot[R]{Aurélien THIRIET}
\fancyfoot[C]{\thepage}

\usepackage{stmaryrd} % for \llbracket 1,n \rrbracket
\newcommand{\itemcirc}{\item[$\circ$]}
\usepackage{bbold} % pour le \mathbb{1}
\usepackage{minted}
\usepackage{caption}
\usepackage{subfig}
\usepackage{graphicx}
\usepackage{subcaption}

\title{\Huge{
  UMR AMAP Internship report
  }\\
  \vspace{1\baselineskip}
  Attempt of tree-grass interaction model fitting in savannas based on massive satellite data
  }
\author{\LARGE{Aurélien THIRIET}
}

\date{\LARGE{January 15th - July 20th 2024}}

\begin{document}

\maketitle
%\thispagestyle{empty}
\pagenumbering{ }

\vspace{3\baselineskip}

\begin{figure}[htbp]
\centering
\includegraphics[width=0.4\linewidth]{Images/logo_amap.jpg}
\includegraphics[width=0.2\linewidth]{Images/logo_ird.png}
\includegraphics[width=0.15\textwidth]{Images/Logo_um.png}\includegraphics[width=0.2\textwidth]{Images/logo_fac_sciences.jpg}
\caption*{}
\label{fig:myfig}
\end{figure}

\begin{center}
\Large{Intership directors}\\
\LARGE{Dominique LAMONICA, Pierre COUTERON}
\end{center}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage 
\pagenumbering{ }
%\thispagestyle{empty}

\null

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage

\section{Contribution}
\pagenumbering{roman}

(half a page max)

\section{Summary}
(350 words)

\begin{abstract}
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum pretium libero non odio tincidunt semper. Vivamus sollicitudin egestas mattis. Sed vitae risus vel ex tincidunt molestie nec vel leo. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Maecenas quis massa tincidunt, faucibus magna non, fringilla sapien. In ullamcorper justo a scelerisque egestas. Ut maximus, elit a rutrum viverra, lectus sapien varius est, vel tempor neque mi et augue. Fusce ornare venenatis nunc nec feugiat. Proin a enim mauris. Mauris dignissim vulputate erat, vitae cursus risus elementum at. Cras luctus pharetra congue. Aliquam id est dictum, finibus ligula sed, tempus arcu. 
\end{abstract}

\keywords{Forest, Savanna, Mean annual precipitation, Fires, Generalized Linear Models \textit{(GLM)}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage 
% Summary
\tableofcontents
peut importe si ça déborde , de toutes façons il y a des parties de sections qui vont partir en annexe au final
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\pagenumbering{arabic}
\section{Introduction}

\par An ecosystem can be defined as the set of all living beings interacting together in a zone relatively homogeneous considering physical and chemical caracteristics. The choice of those caracteristics defining the zone remains arbitrary, consequently, so is the definition of the zone. The set of living beings is called biocenose, and the overall relatively homogeneous zone, the biotope.
\par The Holdridge system, published in the 1950s-1960s, has a latitude axis (from polar to tropical) and an annual precipitation axis, and determines an associated vegetation type (biocenose). For a given latitude, and a given annual precipitation, it gives a predicted vegetation type :

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.17]{Images/holdridge_system.png}
\caption{Holdridge's system}
\label{fig:holdridge_system}
\end{figure}

The potential evaporation is calcultated as a multiplicative constant of a heat summation index. The potential evapotranspiration ratio is calculated as the potential evaporation divided by annual precipitation\cite{bond_open_ecosystems_2019}. So we can really consider this three-dimensional array as a two-dimensial one. 

\par The problem is, that in many parts of the world, there is probably no bijection between climate and perennial vegetation type, particularly those where there are two vegetation types intermingling, such as forests and grasslands. Hoping to predict the ecosystem in those lands from the mere information of latitude and annual precipitation is inadequate in regions that the professor of ecology William Bond defined as \textit{brown} world, where the effect of herbivory over vegetation is such that it can surpass the climatic determination, and the \textit{black} world, where the effect of wildfires over vegetation is such that it can surpass the climatic determination. The \textit{green} world would be the set of the zones where the climatic determination over vegetation type, such as the one assessed by Holdrige, remains.
\par In 1975, Whittaker developed a two-axis temperature-precipitation model determining the main biomes, which for the first time included an undetermined zone of uncertainty comprising “uncertain ecosystems”, particularly between 500 and 1500 mm of annual rainfall and 10 and 30°C. We can see those undetermided regions in black in the figure \ref{fig:whittaker_uncertain} below\cite{Bond 2005}.

\newpage

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.25]{Images/whittaker_uncertain.png}
\caption{Undetermined ecosystems by Whittaker}
\label{fig:whittaker_uncertain}
\end{figure}

\par We can see that a large part of the world fell into this indetermination. The concept of non-climatic determined zones was developed and extended further Whittaker's work. A subdiscpline that is sometimes called \textit{fire ecology}, inside \textit{disturbance ecology}, has considerably developed itself in the 2000s, 2010s. \textit{Fire ecology} really thinks wildfires as a central element of ecosystems existence and shape in the concerned ecosystems, from the anatomical plant perspective to the global landscape perspective. William Bond wrote in 2019 a remarkable book \textit{Open Ecosytems, ecology and evolution beyond the forest edge} that summarizes the scientific research over the last fifty years about those surprising ecosystems that can differ from the ones excepted by pure climatic inference, he's also the creator of this concept of \textit{green, brown and black world}, that form a \textit{multicoloured world} and I'll quote him often in this report.\\

\par We were especially interested in African savannas in the context of my internship. Beside mere scientific motivation, increasing knowledge, in the context of deforestation and afforestation throughout our XXIst century world, there is a real interest for understanding why some very extended ecosystems do not fit their expected climatic scenario, and what they could become.\\

\par The concept of \textit{Alternative Stable State (ASS)} that emerged at the end of the 1970s, refers to ecosystems which, after minor disturbances, return to their previous state. The implications of this concept are the following.
\begin{itemize}
       \itemcirc Disturbances are part of the ecosystem. They are not restricted to being the first stages of an ecological succession, which is often implicitly assumed in most non-ASS works.
       \itemcirc Disturbance regimes select the traits of biomes. Whis this concept we can finally understand them. A typical example is the traits associated with fire in the environments of the \textit{black world}. This concept also makes it easier to anticipate how wildlife, living in an ecosystem that may be specifically linked to a disturbance, might react to climate change.
       \itemcirc Stable alternative states make it possible to imagine changes in biomes whose cause is not necessarily climatic.
       \itemcirc This makes it possible to implement appropriate conservation strategies.
    \itemcirc Differences in resources can be seen as the consequence of biotic mechanisms.
\end{itemize}

\par Palaeoecology has been one of the major elements supporting the theory of ASS (\textit{Alternative Stable States}), by making it possible to show that some open ecosystems have existed for thousands of years and by showing and dating the alternation of ecosystem types in certain places. Carbon isotopes can be used to differentiate between the ancient presence of C3 photosynthesis plants and C4 typical savannas photosynthesis herbaceous plants.\\

\par My internship was based over an ordinary differential equations model that aims to predict the development of forests over savannas and reciprocally according to different parameters. This model was fundamentally contained in the ASS theory. The initial goal of my work was to develop a more precise version of this model. The section \ref{section_2021_EDO_model} is a concise summary of this model. But before that, let's briefly introduce the savanna-forest context.

\section{Global objectives}

section utile ou redondante ?


\section{Materials and Methods}

\subsection{Savanna-forest environment}\label{section_intro_savanna_forest}

\par definitions \\

\par Facilitation/Competition : \textit{This means that the impact of tree biomass on grass biomass ranges from possible facilitation, in arid and semi-arid parts of the rainfall gradient, to competition in the humid part with the tipping point located around a mean annual rainfall of ca. 600 mm yr−1. Indeed, according to Abbadie et al. (2006, page 156)\cite{citer ici}, trees generally improve the water budget beneath their canopy in arid environment and this favors a higher grass primary production beneath a tree canopy than in the open. In addition, trees are liable to improve significantly the nutrient soil conditions in arid and semi-arid savannas (see Abbadie et al. (2006, page 156)). Conversely, in humid savannas, water is no longer a limiting resource and the tree–grass competition in these areas is more for light availability and nutrients.} \cite{2021_EDO_model}

\subsection{ODE 2021 model}\label{section_2021_EDO_model}
\subsubsection{Modelling open ecosystems with differential equations}

\par L'intérêt initial ayant motivé la création de ce stage fut la volonté d'approfondir l'article \textit{A minimalistic model of vegetation physiognomies in the savanna biome}, paru en 2021 dans le journal \textit{Ecological Modelling}\cite{2021_EDO_model}. Ce modèle avait été développé par I.V. Yatat Djeumen, Y. Dumont, A. Doizy et ultimement par la supervision de mon encadrant de stage P.Couteron.
\par D'autres modèles de type EDO avait été proposés au fil des années pour modéliser la dynamique forêt-savane, notamment le modèle de Higgins 2010 \cite{higgings 2010}, qui modélisait la compétition forêt-savane par une double-compartimentation biomasse souterraine/biomasse aérienne. \cite{Citer d'autres articles avec Bond peut-être} Nous avons d'ailleurs pu rentrer en contact avec P.Higgins par visioconférence en début de mon stage et des suites directes de ce modèle sont actuellement en train d'être développés par un doctorant sous son encadrement. L'objectif de son travail est d'estimer par calibration bayésienne dite inverse les paramètres de leur système d'équations, en mettant à jour les informations du modèle avec des données récupérées sur le terrain [à vérifier].
\par Le terme d'estimation inverse tend à insister sur le fait que des hyperparamètres du modèles, à partir desquels d'autres paramètres sont estimés dans leur ajustement aux données, sont aussi estimés. Avec D.Lamonica, nous y préférons le terme de calibration de paramètres, puisqu'il s'agit d'une estimation de type \textit{Monte-Carlo Markov Chain (MCMC)} qui n'est pas nécessairement ontologiquement différente des calibrations bayésiennes de modèle usuelles, si ce n'est qu'elle est réalisée en chaque point d'une maillage temporel.
\par L'une des motivations ayant présidé à la création de l'article de 2021 était de fournir un modèle simplement appréhensible, où la plupart des paramètres centraux ont une signification physique claire (et donc une unité physique simple), en opposition à des modèles où les paramètres renvoie à des mesures très difficilement obtenables.
\par L'article propose une modélisation de l'occupation relative de la biomasse de forêt, $T$ (pour $Tree$), et de la biomasse herbacée de savane, $G$ (pour $Grassland$), en fonction du temps, à l'échelle d'une zone dont la dimension n'est pas définie, le modèle étant local. Le modèle est basé sur le couple d'équations différentielles ordinaires :

\begin{equation}
\left\{
    \begin{array}{ll}
        \frac{dG}{dt} = \left(\frac{\gamma_G W}{b_G + W}\right)G\left(1-\frac{G}{K_G(W)}\right)-\delta_G G - \eta_{TG}(W)T G - \lambda_{fG}(W)fG \\
        \frac{dT}{dt} = \left(\frac{\gamma_T W}{b_T + W}\right)T\left(1-\frac{T}{K_T(W)}\right)-\delta_T T - f \theta(T) \omega(G)T
    \end{array}
\right.
\label{equations_modele_2021}
\end{equation}

Le terme d'équation ordinaire (EDO) fait référence à une équation différentielle de type $X'(t)=F(t,X(t))$ \cite{random livre de maths}. Dans ce tel type d'équation, la fonction $F$ ne dépend que d'un seul paramètre (appelé ici $t$, notation usuelle depuis Newton (on trouvera une réflexion intéressante à ce sujet chez Etienne Klein) du paramètre modélisant le temps) en opposition aux équations aux dérivées partielles (EDP), où des dérivées par rapport à plusieurs paramètres peuvent intervenir. Une généralisation ultérieure d'un modèle forêt-savane avec un terme de propagation a été amorcée par une collègue en parallèle de notre travail, et l'inclusion de la spatialité d'abord en 1 puis en 2 dimensions, à des modèles purement temporels tendrait mieux à rendre compte de la propagation des milieux. J'ai jusqu'à présent seulement été amené à travailler sur le modèle d'équations non spatial \ref{equations_modele_2021} durant la période de mon stage mais nous avons régulièrement échangé avec elle sur les possibilités et difficultés de ces développements.
\par Mon travail a d'abord considéré à comprendre ce type de modésation par équations différentielles et ce modèle \ref{equations_modele_2021} en particulier. Je propose une restitution succincte du modèle partie suivante, à la fois à des fins de compréhension de mon travail de stage et comme restitution d'un élément que nous pensions initialement structurant de mon travail.

\subsubsection{An application of the well-known principle of logistic growth}

Le modèle de croissance logistique est défini par une quantité $N(t)$, dépendant du temps $t$, avec $r>0$ (lié au taux d'accroissement) et $K>0$ (dite capacité porteuse, ou capacité limite), par \cite{cours_lyon} :

\begin{equation}
    \frac{dN(t)}{dt} = rN(t)\left(1-\frac{N(t)}{K}\right)
\label{croissance_logistique}
\end{equation}

Avec la condition initiale $N(0)=N_0\in]0,K[$, l'équation \ref{croissance_logistique} adment la solution :
\begin{equation}
N(t) = \frac{N_0 K}{N_0 + (K-N_0)e^{-rt}}
\end{equation}
de forme sigmoïdale, avec $N(0)=N_0$ et $N(t)\underset{t\to +\infty}{\longrightarrow}K$.\\

[mettre une phrase sur le document des gnous du serengeti comme illustration]
La première partie des équations \cite{2021_EDO_model} est de cette forme pour les biomasses par surface (tonnes par hectare) ligneuse $T$ et herbacée $G$, avec des capacités porteuses respectives $K_T(W)$ et $K_G(W)$, fonctions de la précipitation annuelle moyenne $W$ (en millimètres par an). Le $r$ de l'équation \ref{croissance_logistique} devient $\frac{\gamma_T W}{b_T + W}$ et $\frac{\gamma_G W}{b_G + W}$, soit respectivement les productions annuelles de biomasse de ligneux et d'herbacées.
\par Les capacités porteuses $K_T(W)$ et $K_T(W)$ ont été ajustées par des régressions quantile non linéaires comme des fonctions croissantes bornées de la disponibilité en eau $W$, encore une fois de forme sigmoïdale :

\begin{equation}
    K_T(W) = \frac{c_T}{1+d_T e^{-a_T W}}
\end{equation}

La pluie agit comme un facteur explicatif essentiel à la fois sur le développement de la biomasse ligneuse $T$ et de la biomasse herbacée $G$, d'où sa présence centrale dans les équations. On remarquera que contrairement aux cas usuels de croissance logistique, où la quantité $N(t)$ désigne un nombre d'individus, les quantités $T(t)$ et $G(t)$ sont des masses surfaciques.

Le paramètre d'intensité du feu $\omega(G)=\frac{G^2}{G^2+\alpha^2}$ est le même que dans Yatat (2017) et Yatat (2018). Ce paramètre est ainsi défini car : \textit{at low grass biomass there is no fires while above a sufficient grass biomass, fires intensity and potential impact on woody individuals increases rapidly before reaching a saturation}\cite{Yatat 2018}. $\omega$ est une fonction croissante à valeurs dans $[0,1]$ telle que $\omega(0)=0$ et $\omega(G)\underset{G\to +\infty}{\longrightarrow}1$.
\par Pour un niveau $\omega(G)$ fixé, la mortalité des ligneux $\theta(T)=\lambda^{min}_{fT} + (\lambda^{max}_{fT}-\lambda^{min}_{fT})e^{-pT}$ est supposée être une fonction non linéaire décroissante de $T$. L'idée est que le feu affecte différemment les arbres selon leurs tailles (supposée proportionnelle à la biomasse). L'augmentation de la hauteur des arbres, donc par hypothèse de $T$, diminue l'impact de l'intensité du feu $\omega(G)$ à travers le terme $\theta(T)$ que multiplie $\omega(G)$ dans l'équation \cite{2021_EDO_model}. Ce choix de modèle implique que le feu est peu intense face à une forêt très haute. $\theta(0)=\lambda^{max}_{fT}$ et $\theta(T)\underset{T\to +\infty}{\longrightarrow}\lambda^{min}_{fT}$, avec entre les deux une forme exponentielle dont la vitesse est contrôlée par le coefficient $p$.
\par Dans le modèle, la perte de biomasse herbacée n'est pas impactée par l'intensité du feu $\omega(G)$ car toute intensité de feu est supposée affecter de même manière la couche herbacée. Cette perte est en revanche modulée par $\lambda_{fG}(W)=\lambda^{min}_{fG} + (\lambda^{max}_{fG}-\lambda^{min}_{fG})\frac{W}{W+S}$. On retrouve une forme similaire à la forme de $\theta()$, sauf qu'au lieu d'avoir une fonction en $T$, on a ici une fonction en $W$, et qu'au lieu d'avoir une fonction exponentielle décroissante, on a ici une fonction croissante à valeurs dans $[0,1]$. $S$ est un paramètre de précipitation en millimètres par an, tout comme $W$ (d'où l'homogénéité de la fraction) dont il est dit qu'il "sépare les faibles valeurs des hautes valeurs de $\lambda_{fG}(W)$".
\par Une des nouveauté de Yatat (2021) est de prendre en compte l'effet possible de facilitation de la biomasse ligneuse sur la biomasse herbacée en régime aride, et pas seulement l'ascendant de de la biomasse ligneuse sur la biomasse herbacée en régime humide. Cela est réalisée à travers le paramètre $\eta_{TG}(W) = a \tanh \left( \frac{W - b}{c} \right) + d$, prenant la forme de la fonction arctangente (à valeurs dans $]-1,1[$) qui peut donc prendre des valeurs négatives selon la précipitation annuelle moyenne $W$. 
\par Parmi les paramètres restants dans \cite{2021_EDO_model}, $\delta_G$ et $\delta_T$ sont des paramètres d'herbivorie en (yr-1), $f$ est une constante en (yr-1).

%\vspace{5\baselineskip}

%\newpage
\subsection{Development of an additional visualisation tool}

I started by choosing to implement a visualisation tool to help us see what $(T(t),G(t))_t$ would be according to this 2021 model. The researchers that had written this article had published a $rshiny$ interface that gave the bifurcation diagram of the model \ref{equations_modele_2021}, but it lacks a general tool to see the temporal evolution predicted by the model.
\par I didn't know how to create an interactive interface. I chose to also use $rshiny$, so I had to learn how it works, then I implemented the 2021 model in it, I used the well-proven \textit{Runge-Kutta 4} implemented in the \textit{deSolve} package \cite{deSolve documentation} method for the numerical resolution. Each time the value of a parameter is moved, the numerical resolution is done again. I've chosen the lower and upper values given in the Table 1 of \textit{Yatat 2021} for possible values of those parameters.

\newpage

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.20]{Images/interface_shiny.png}
\caption{Rshiny interface for the 2021 EDO model}
\label{fig:interface_shiny}
\end{figure}

You can see the general graphs $(t,G(t))$ and  $(t,T(t))$ at the right side, with the asymptotic values that correspond to the bifurcation diagram. [a verifier d'ailleurs] You can chose the step of the EDO resolution in the left upper corner. Those figure give you an insight of what the evolution of tree and grass localy as built in the 2021 EDO model.
\par For instance in the particular set of parameters of the figure \ref{fig:interface_shiny} above, you can see that grass and tree are have an equal biomass of 5 tons per hectare at a given starting time. Then then both quickly increase, but while tree biomass continue to increase itself to the point it reaches the limiting capacity, grass biomass declines and reaches zero. In this particular example, we had a zone with tree and grass in equal biomass, but under the conditions we chose, trees totally extend themselve to the capaciting limit while grass disappeared.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Remote sensing GEDI data}

We had originally planed, for my internship, to perform an inverse calibration of the EDO model as D. Lamonica had done in her 2016 ecotoxicology article \cite{cite}. We would have had to use cunning to get temporal data biomass estimation since that data is missing.
\par Very early, we were contacted by Le Bienfaiteur Sagang, former student of the Yaounde university and from now on researcher in Los Angeles, that proposed to share with us satellite data that he had collected through weeks of code execution. So my internship moved from its initial goal and we aimed to explore this data and see how it could help us to calibrate the EDO model.\\

\par Description des données... Référence à une carte générale en annexe, pour amorcer notre choix de nous concentrer sur sur les trois zones \textit{Sahelian Acacia, West Sudanian et Guinean forest-savanna}, fin de partie \ref{section_preprocessing}.\\

\par definition of an ecoregion

\par faire un rapide paragraphe avec le nom des variables et les abbréviations

\subsection{First raw analysis of GEDI data}
\subsubsection{\textit{Preprocessing} : handling of missing data and choice of variables of interest}\label{section_preprocessing}

% description détaillée mail du 4 Mars

\par I first started my handling of those massive data by looking at the missing data for each variables and 'cleaning' it in a way that it will be usable for our later statistic methods, but without modifying it to much, so that it could be considered to be nearly as close to the raw data as it could be, and we called that \textit{step 0 'preprocessing'}.
\par From now on, all the R scripts I had to create where general scripts, that execute the commands for all the wanted ecoregions. That's the case for displaying the values of the variables through space, the non available data through space, correlation matrices, all the histograms, and after all the generalized linear models [ref to following figures here]. Indeed, it would be a waste of time and of clarity not to have a general code that just had to be adapted at its beginning to select the wanted ecoregions on wich we want to apply our analysis. If I want to apply a change in my histograms analysis for instance, I can apply it at once to all my ecoregions instead of having to do it again and again for the 24 ecoregions. Moreover, then if the dataset is a bit changed, which happened to us during the middle of our analysis, the genericity of the code allowed us to get all the figures we had previously almost instantly. And if we want to consider patches of ecoregions together, or to realize some tests just over a specific ecoregion, it then can be easily done.\\

\par So one of the first things I did, along with the preliminary summaries, was to create a code to get the missing data percentages by ecoregion. We get the following table \ref{fig:missing_data_table} in supplementary material \ref{section_supplementary_material}. If we get the means of missing data percentages for each variable, giving all ecoregion a weight of 1, we get the means of missing data per ecoregion (which is different from the missing percentage of each variable above all data) :

\begin{table}[!ht]
    \centering
    \begin{tiny}
    \begin{tabular}{l|l|l|l|l|l|l|l|l|l|l|l}
    \hline
        x & y & rh98 & canopy\_cover & fire\_freq & mean\_precip & cv\_rainfall & eff\_rainfall & mean\_temp & temp\_range & ecoregion & one variable missing \\ \hline
         0.00 & 0.00 & 0.00 & 0.11 & 0.47 & 0.03 & 0.03 & 0.03 & 0.05 & 0.05 & 0.00 & 0.53 
    \end{tabular}
    \end{tiny}
    \caption{Mean missing data per ecoregion for each variable}
\end{table}

% https://tableconvert.com/csv-to-latex


\par The missing data for the fire frequency variable seemed a lot, especially in certain ecoregions (table \ref{fig:missing_data_table}). For instance there were $0.65$ in \textit{Angolan mopane} or even $0.89$ in \textit{Northern Congolian} and in \textit{Sahelian Acacia}. The problem is we can hardly work in those ecoregions if we delete all the missing data, so we had to decide if it was an insurmountable obstacle considering that fire frequency seemed to be the main central variable in savanna-forest dynamics that was missing.
\par For this purpose, I created different scripts (a generic one again, to get it automatically done for all the 24 ecoregions) to get pieces of information about fire frequency. So we got a lot of folders containing data information for 24 figures. So for instance we displayed all the 24 maps of fire frequency and fire frequency missing data (we've put Sahelian Acacia, West Sudanian and Guinean forest-savanna maps of fire frequency and fire frequency missing data in figure \ref{section_NA_fire_freq_through_space} section \ref{section_supplementary_material}). We also displayed it for canopy cover, rh98 and mean precipitation.\\

\par With the table of missing data percentages and those maps, we made two choices :
\begin{itemize}
    \itemcirc to focus on Sahelian Acacia, West Sudanian and Guinean forest-savanna ecoregions
    \itemcirc and to replace the fire frequency values by 0.\\
\end{itemize}

\newpage

Indeed, here a graph of theoretical grass or forest growth with rain, with the three zone highlighted : 

\begin{figure}[htbp!]
\centering
\includegraphics[scale=0.3]{Images/holling3.png}
\caption{[faire mieux cette figure]}
\label{fig:myfig}
\end{figure}

\par The three zone correspond to the three parts of this graph. Then we have a nice rain gradient to work on over three zones that are spacially next to each other, from the wet forest [?] of Guinean ecoregion to the very arid lands of Sahelian Acacia, passing through West Sudanian which theoretically includes the most the forest-savanna dynamics.
\par Our second choice of replacing 'NA' values by 0 for \textit{fire frequency} could be called the \textit{certain fire detection hypothesis}. It seems legitimate to do this hypothesis, or approximation, on those three ecoregions at least, considering that there is little missing fire frequency data in the the Guinean ecoregion ($0.22\%$, see table \ref{fig:missing_data_table}) and that most of the missing data occur in as we get to the arid lands in Sahelian Acacia ($0.89\%$), with intermediate missing data percentage ($0.29\%$) in West Sudanian happening mostly in the North next to the Sahelian Acacia zone. So the visual repartition of the missing fire frequency data seems to correspond spacially to the absence of detection of fire by the GEDI satellite. Thus, the certain fire detection hypothesis showed itself legitimate for those three neighbouring ecoregions, that revealed themselves very convenient to make all our tests on a global region that was both consitent from the ecological perspective and statistical needs.
\par I've still kept track of this modification in an additional column \textit{Fire\_freq\_NA} which is 'TRUE' is the 0 is a zero given by the GEDI data we've get and 'FALSE' if we've made this transformation under the previous hypothesis. Then I've conserved only data for which there were data for the following variables : $x$, $y$, $rh98$, $canopy\_cover$, $fire\_freq$, $mean\_precip$, $mean\_temp$, $ecoregion$, $fire\_freq\_NA$. There were no data missing for $x$, $y$, $rh98$, $ecoregion$, nor for $fire\_freq$ (and so $fire\_freq\_NA$) with our transformation.
\par Overall, the choice of the 3 ecoregions  was based on the criteria of rain/forest gradient and certain fire detection hypothesis, and those ecoregions form $75\%$ of our data in terms of the number of points (x,y,variables) of GEDI data since we had around :

\begin{itemize}
    \itemcirc 21 million points 
    \itemcirc 7 million points for West Sudanian
    \itemcirc 3 million points for Guinean forest-savanna
\end{itemize}

out of a total of all your data, which was around 45 million points, which represents approximately $75\%$  of the data, after fire frequency NA replacement by 0.\\

\par Finally, by manipulating the data, I realized that there were duplicated data (I mean points that have exactly the same $(x,y)$ coordinates) at the edge of the ecoregions. For instance :

\begin{minted}{R}
 rowname ; "x" ; "y" ; variables ...
"1",-16.40885155,13.99013765,2,3.194999972,647.4732562,...,"Guinean forest-savanna",TRUE
"2",-16.40885155,13.99013765,2,3.194999972,647.4732562,...,"West Sudanian",TRUE   
\end{minted}

Those points happened to be points among those at the the edge of two ecoregions that were included in both of them. So I've removed the duplicates by keeping a single value instead of two for each of the duplicated values. Of the 45,727,445 points obtained after fire replacement, I obtain 45,724,087 points. So we had 6,716 duplicates, which means we removed 3,358 pieces of data. It's not significant on a global scale but it's good to be sure and to work without duplicates anyway. This step ended the  \textit{preprocessing} treatment and we therefore had in another folder this preprocessed data usable for statistics.

\subsubsection{Individual variable distributions}

\par In parallel, I've made a script to save the histograms of \textit{canopy cover}, \textit{rh98}, \textit{fire frequency} and \textit{mean precipitation} for all the 24 ecoregions. As we have explained in the previous section, we finally focused on Sahelian Acacia, West Sudanian and Guinean forest-savanna ecoregions. Here are the histogram of the Guinean ecoregion, West Sudanian and Sahelian Acacia are in supplementary material \ref{}

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.8]{Images/hist_Guinean_forest-savanna.png}
\caption{Guinean histograms}
\label{fig:hist_Guinean}
\end{figure}

\par We've noticed that the general appearance of \textit{canopy cover} seemed to be an exponential decrease for 0 to 1, and the general appearance of \textit{rh98} reminded us of the Gamma distribution. The exponential decrease being a case allowed by Beta distribution, this incited us to consider the Beta regression that we developed further for \textit{canopy cover} and the Gamma distribution that we developed for \textit{rh98}.
\par We can also see that histograms from Guinean, West Sudanian and Sahelian ecoregion seem to have the same profile (figures \ref{fig:hist_Guinean} and \ref{fig:hist_Sahelian}-\ref{fig:hist_Sudanian} from the annexe \ref{section_sahelian_sudanian_histograms}) but with a shrinked aspect for forest variables as we get from Guinean to Sahelian, i.e. with a reduction of variance along the latitude gradient. As we get from wet to arid, the exponential decrease of \textit{canopy cover} is steeper and the \textit{rh98} is more tightened around its mean value. 

\subsubsection{Two-by-two variable distributions : correlation matrices and scatterplots}

ici faire les commentaires sur les valeurs pertinentes de la figure \ref{fig:correlation_matrix_all_data} et faire un paragaraphe relevant les valeurs intéressantes des trois autres matrices en annexe

\begin{figure}[htbp!]
\centering
\includegraphics[scale=1]{matrices_correlations/all_data.png}
\caption{Correlation matrix for all the data}
\label{fig:correlation_matrix_all_data}
\end{figure}

\begin{center}
\end{center}

% relever les corrélations particulières sur les 3 zones en un paragraphe et faire référence à l'annexe

\newpage

\subsection{First interaction diagram conception}

\par paragraphe sur "le modèle salade", David, et le bouquin Statistical rethinking\\
\par blabla sur daggity\\

\par Considering our data, we arrived at the following interaction graph :

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.4]{Images/graph_interaction.png}
\caption{Interaction graph made with \textit{daggity} tool}
\label{figure:graph_interaction}
\end{figure}

\par Mean annual precipitation obvisouly influences grass biomass. Canopy cover is an indicator giving tree presence, that influences grass biomass through facilitation or competition, depending on mean annual precipitation. Grass biomass influences the fire frequency since grass is the main fuel for fire. Finally, both fire frequency and mean annual precipitation influence the canopy cover and the tree tallness.
\par One would notice that canopy cover and rh98 have the same role in this system, which is a consequence of the fact that there are both aspect of forest biomass. We have prefered to use canopy cover to determine grass biomass because we thought it was a better indicator of the global tree presence that tree tallness.\\

\par This graph implies the following conditional independences :
\begin{itemize}
    \itemcirc \textit{canopy cover} (\%) is independant of \textit{rh98} (m) knowing \textit{fire freq} (yr-1) and \textit{mean precip} (mm yr-1)
    \itemcirc \textit{grass biomass} (t ha-1) is independant of \textit{rh98} (m) knowing \textit{fire freq} (yr-1) and \textit{mean precip} (mm yr-1)
\end{itemize}

Canopy cover and rh98 are globally correlated at 0.8, but knowing fire freq and mean precip, they can be thought as independant. [le vérifier, comment ?]. The independance of canopy cover and grass biomass knowing fire fre and mean precip is also suitable.\\

We can see the centrality of grass biomass in the way we represented figure \ref{figure:graph_interaction}. Nevertheless, we don't have data for this quantity. So testing how graph is in fact very technical, as we should estimate grass biomass at the same time.
\par A first step of testing this model is to calibrate it without estimating grass biomass. This is figure \ref{figure:graph_interaction} without grass biomass. It is equivalent of just regarding how fire freq and mean annual precipitation can explain canopy cover and how fire freq and mean annual precipitation can explain rh98. So

\subsection{First GLM regressions}
\subsubsection{Cadre GLM}
\par [écrit de mémoire, à vérifier] Le modèle linéaire standard, comme simple problème d'optimisation, a été développé dès le début du XIXème siècle par Legendre et Gauss. Sa formulation statistique s'est affirmée dans la première moitié du XXème siècle. C'est au XXème siècle que sont nées les régressions Poisson et logit. Au début des années 1970, Nelder et Wedderburn ont proposé la formulation, pour n'importe quelle loi usuelle appartenant à la famille exponentielle, d'un modèle linéaire généralisé.\\

\par Exposons avec exactitude la cadre du modèle linéaire généralisé (\textit{Generalized Linear Model}) , dit $GLM$). Soit $Y$ une variable aléatoire à valeurs dans $\mathbb{R}$, de loi $\mathbb{P}_{Y}$. On dit que la loi de $Y$ appartient à la famille exponentielle si elle peut s'écrire sous la forme :

\begin{equation}
\mathbb{P}_{\theta}(dy)=\exp\left(\left(\frac{y\theta - b(\theta)}{\phi}\right)+c(y,\phi)\right)\nu(dy)
\label{distribution_exponential_family}
\end{equation}

où $\nu$ est une mesure de référence, $b$ et $c$ des fonctionnelles, $\phi>0$ un paramètre de nuisance et $\theta \in \mathbb{R}$, dit paramètre naturel de la loi, appartient à $D_{\nu,\phi}=\{\theta, \int \exp\left(\left(\frac{y\theta - b(\theta)}{\phi}\right)+c(y,\phi)\right)\nu(dy) <\infty\}$.\\ Si $\theta \in \mathring{D}_{\nu,\phi}$, alors $b'(\theta) = \mathbb{E}_{\theta}(y)$.\\

On considère un phénomène dont on a $n$ réalisations $(y_i)_{i\in\llbracket 1,n \rrbracket}\in \mathbb{R}^n$ qu'on suppose issues d'une même famille de lois mais de paramètres $(\theta_i)_{i\in\llbracket 1,n \rrbracket}\in {\mathbb{R}}^{n}$ potentiellement différents. On suppose ces lois indépendantes. Soient $(x_i)_{i\in\llbracket 1,n \rrbracket}\in{(\mathbb{R}^{p})}^{n}$ les covariables supposées expliquer le phénomène.\\

\par Un modèle linéaire généralisé pour données ${(x_i,y_i)}_{i\in\llbracket 1,n \rrbracket} \in (\mathbb{R}^p\times\mathbb{R})^n$ est déterminé par la donnée d'une famille exponentielle ${((\mathbb{P}_{\theta_i})_{\theta_i\in\mathbb{R}})}_{i\in\llbracket 1,n \rrbracket}$, de paramètres $\beta \in \mathbb{R}^{p}$ et d'une fonction $\gamma:\mathbb{R} \longrightarrow \Theta$, où $\Theta$ est l'espace du paramètre de la loi, telle que :

$$\mathbb{E}(y_i)=\gamma\left( x_i^{T}\beta \right) \Longleftrightarrow \gamma^{-1}(\mathbb{E}(y_i))= x_i^{T}\beta$$

$\gamma^{-1}$ est appelée la fonction de lien. Elle relie $\theta_{i}$ à $x_i^{T}\beta$ puisque $\mathbb{E}(y_i)=b'\left(\theta_{i}\right)$.\\

Si $\gamma=b'()$, on parle de lien canonique.\\

\subsubsection{Beta and Gamma distributions}

Dans le cadre des données GEDI \textit{canopy cover} et \textit{rh98}, il apparaissait naturel de regarder si le caractère explicatif de la précipitation annuelle moyenne et du feu se manifestait à travers un $GLM$. Effectuer un $GLM$ sur l'ensemble de nos données ne nous est pas paru pertinent immédiatement pertinent tant la zone géographique couverte par nos données était large. Même à mettre un effet aléatoire $\epsilon_i$ dépendant de l'écorégion $i$, tant ces zones sont vastes. L'écorégion \textit{Acaccia Sahelia} s'étend du Sénégal jusqu'à la mer rouge.

S'est donc ensuite posée la question : que choisir comme lois ?

Les données \textit{rh98} sont à valeurs dans $[0,+\infty[$, il m'est donc apparu naturel de les modéliser avec une loi Gamma, d'autant que les allures des histogrammes semblaient correspondre à cette image :

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.2]{}
\caption{Un histogramme des données rh98}
\label{fig:myfig}
\end{figure}

\subsubsection{Gamma distribution}

La loi Gamma est une loi à support dans $\mathbb{R}_{+}$ dont la fonction de densité $f$ peut s'écrire sous la forme :

\begin{equation}\label{gamma_distribution}
    f : y \mapsto \left( \frac{1}{\Gamma(\alpha)} \right) \beta^{\alpha} y^{\alpha - 1} \exp(-\beta y)
\end{equation}

avec $\beta>0$ appelé $rate$. On a $\beta = \frac{1}{\sigma}$ et $\mathbb{E}(X)= \frac{\alpha}{\beta}$ et $\mathbb{V}(X)= \frac{\alpha}{\beta^2}$.
C'est cette paramétrisation qui est utilisé dans JAGS\cite{martyn_plummer_jags_2017_reference_manual} 
 avec la commande \textit{y $\sim$ dgamma(alpha, beta)} ou dans STAN\cite{team_stan_nodate_function_reference} avec la commande \textit{y $\sim$ gamma(alpha, beta)}. Dans $R$ il faut prendre garde au fait que c'est la paramétrisation $\sigma=\frac{1}{\beta}$ qui est utilisée. C'est encore une autre paramétrisation qui est utilisée dans \textit{brms}.\\

 A la fois le support et les formes possibles prises par cette distribution semblent adaptés pour les données rh98. Dans le cadre $glm$, le paramètre de la loi Gamma qu'on ajuste à une combinaison linéaire de paramètres est le paramètre $rate$ $\beta$ (ou $scale$ $\sigma$). Le paramètre $\alpha$ est supposé identique pour toutes les observations.

\subsubsection{Beta distribution}

La loi Beta est une loi à support dans $]0,1[$ dont la fonction de densité $f$ peut s'écrire sous la forme :

\begin{equation}\label{densite_beta}
    g : y \mapsto \left( \frac{1}{B(\alpha,\beta)} \right) y^{\alpha -1} (1- y)^{\beta -1} \mathbb{1}_{]0,1[}(y)
\end{equation}

avec $\alpha > 0$ , $\beta >0$ et $B : (\alpha,\beta) \mapsto \int_{0}^{1} t^{\alpha -1} (1-t)^{\beta -1} dt$ est la fonction Beta, qui peut aussi s'écrire $B : (\alpha,\beta) \mapsto \frac{\Gamma(\alpha)\Gamma(\beta)}{\Gamma(\alpha + \beta)}$ où $\Gamma$ est la fonction Gamma précédemment introduite.

Cette paramétrisation est celle qu'on trouve dans la documentation de R, notamment utile pour les fonctions $dbeta$, $rbeta$. Les paramètres $\alpha$ et $\beta$ sont appelés respectivement $shape1$ et $shape2$.\\

Sous cette paramétrisation, on a $\mathbb{E}(X)=\frac{\alpha}{\alpha + \beta}$ et $\mathbb{V}(X)=\frac{\alpha \beta}{(\alpha + \beta)^{2}(\alpha + \beta + 1)}$. \\

Cette même paramétrisation est utilisé dans JAGS\cite{martyn_plummer_jags_2017_reference_manual}  à travers la commande \textit{y $\sim$ dbeta(alpha, beta)} ou dans STAN\cite{team_stan_nodate_function_reference}
 avec la commande \textit{y $\sim$ beta(alpha, beta)}. C'est une autre paramétrisation qui est utilisée dans \textit{brms} :

\begin{equation}\label{beta_brms}
    f : y \mapsto \left( \frac{1}{B(\mu \phi,\phi(1-\mu))} \right) y^{\mu \phi -1} (1- y)^{\phi(1-\mu)-1} \mathbb{1}_{]0,1[}(y)
\end{equation}

avec $\mu = \frac{\alpha}{\phi}$ et $\beta = \phi(1-\mu)$ où $\phi$ appelé \textit{precision parameter}. On a $\mathbb{E}(X)= \mu $ et $\mathbb{V}(X)= \mu(1-\mu) \left( \frac{1}{\phi + 1} \right)$.\\

C'est $\mu$ qui est estimé, la valeur de $\phi$ étant considérée commune à toutes les observations. Nous avons compris qu'il était logique que $brms$, spécialement conçu pour les régressions, utilise cette paramétrisation telle que ce soit le paramètre $\mu$ égal à l'espérance de la loi Beta qui soit ajusté, contrairement à $STAN$ qui utilise l'expression classique \ref{densite_beta}. Il a fallu prendre garde à ces paramétrisations lors de l'implémentation.

\subsubsection{Taking 0 values into account}

Nous avons le problème que cette loi beta ne prend pas en compte $0$ ni $1$. Les couverts de canopée de nos données ne comprennent jamais $1$, en revanche ils contiennent $0$. Si on lance une commande $glm$ avec une distribution Beta sur des données dont certaines sont des $0$, on obtient une erreur, à raison, car ce n'est pas pris en compte dans la distribution.

Les modèles linéaires généralisés sont bâtis sur la bijection monotone du prédicteur linéaire $x_i^{T}\beta$ et d'un paramètre $\theta$ de la loi $\mathbb{P}_{\theta}$ par laquelle on modélise le phénomène. La loi de Poisson est à support dans $\mathbb{N}$ mais on peut infléchir la forme de sa densité modifiant le poids de la valeur 0, mais 0 appartient bien au support de la loi de Poisson. De même pour la loi Gamma dont le support est $[0,+\infty[$, elle comprend bien 0. On peut modifier le poids de la valeur 0 avec une loi inflated, mais 0 appartient bien au support de la loi Gamma.\\

La bijection entre l'espace  $]0,+\infty[$ du paramètre $\lambda$ de la loi de Poisson et l'espace du prédicteur linéaire $]-\infty,+\infty[$ est souvent assurée par le lien logarithmique. De même pour la loi Gamma, la bijection entre l'espace  $]0,+\infty[$ du paramètre $\alpha$ de la loi Gamma et $]-\infty,+\infty[$, est souvent assurée par le lien logarithmique. Tout autre bijection monotone entre $]0,+\infty[$ et $]-\infty,+\infty[$ conviendrait.\\

Pour une loi telle que la loi Beta en revanche, l'appelation $inflated$ semble mauvaise puisque si on a des valeurs en 0, la loi Beta standard n'est même pas définie en 0 puisqu'elle est définie sur $]0,1[$. On devrait plutôt parler de mon point de vue de loi beta \textit{extended}.\\

Dans la documentation de $STAN$, il est écrit que la fonction de densité $g$ expression \ref{densite_beta} peut s'écrire sous la forme dite \textit{zero inflated} ainsi :\\

\begin{center}
$h_1(y)=z+(1-z)g(0)$ if $y=0$ and $h_1(y)=(1-z)g(y)$ if $y>0$.
\end{center}

\noindent Ou sous la forme dite Hurdle :\\

\begin{center}
$h_2(y)=z$ if $y=0$ and $h_2(y)=(1-z)g(y)/(1-g(0))$ if $y>0$.
\end{center}

La forme Hurdle n'est pas implémentée pour la loi Beta dans $brms$ au printemps 2024 \cite{burkner_parameterization_nodate}.\\

On remarquera que la formulation de la documentation est étrange puisque $g(0)$ n'existe pas, $g$ n'étant pas définie en $0$. J'ai posé la question sur le forum $STAN$, pourtant assez actif, sans réponse. Il s'agit probablement d'une formulation générale qu'on peut appliquer pour n'importe quelle loi $inflated$ (et pas $extended$), ou alors considérer le prolongement $\tilde{g}(0)=0$, auquel cas la formulation de $h_1$ revient juste à donner un poids $z$ en $0$ et à moduler les valeurs en $]0,1[$ par $(1-z)$, ce qui semble être le cas au vu des sorties de STAN.\\

\par Un moyen alternatif de surmonter ce problème de couvert de canopée ayant une valeur nulle est de leur attribuer artificiellement une valeur $\epsilon$. Cela revient à poser la question s'il y a une différence intrinsèque sur nos données entre une valeur de couvert de canopée absolument nulle et une valeur de couvert de canopée très faible.
\par Nous pouvons considérer qu'il n'y a pas de différence énorme qui peut être faite dans l'interprétation entre les deux, l'erreur de précision liée à la donnée GEDI elle-même appuie dans ce sens. Avec ce subterfuge, on évite alors la valeur limite problématique et la bijection impossible entre la valeur ${0}$ et ${-\infty}$ qui n'est jamais atteinte par le prédicteur linéaire.

\subsubsection{A problem of independance}\label{section_independance_problem}

Lorsqu'on réalise un modèle de régression, l'hypothèse centrale, parfois malheureusement oubliée, est que les données explicatives sont supposées être issues de lois indépendantes les unes des autres. Les lois des ${(Y_{i})}_{i\in\llbracket1,n\rrbracket}$ sont en effet supposées être indépendantes de densités respectives, selon l'équation \ref{distribution_exponential_family} :

\begin{equation}
f(y_{i},\theta_i|\beta,\phi)=\exp\left(\frac{y_{i}\theta_{i}-b(\theta_{i})}{\phi}+c(y_{i},\phi)\right)
\end{equation}

de sorte que la valeur approchée par les méthodes pré-implémentées, quelque soit le package $R$, $python$ ou autre, est donc :

\begin{equation}
f(\left(y_1,...,y_n\right),\left(\theta_1,...,\theta_n\right)|\beta,\phi) = \prod\limits_{i=1}^{n}f(y_{i},\theta_i|\beta,\phi)
\label{produit_des_densites}
\end{equation}

Or dans notre cas, les données couvert canopée ne sont pas indépendantes les unes des autres entre n'importe quel point $(x,y)$ et $(x',y')$. De même pour rh98. En effet, s'il y a des arbres en un endroit, cela peut dépendre du fait qu'il y en ait eu ou qu'il y en ait toujours à proximité. On ne peut pas considérer que la donnée du fait qu'il y ait un couvert canopée de 0.2 à un endroit est indépendante du faite qu'il y ait un couvert canopée de 0.3 à 250 mètres.\\

Il a donc fallu trouver des possibilités face à difficulté. Il m'est apparu que face à ce problème, les possibilités pouvaient s'abstraire assez aisément de notre cas spécifique pour s'appliquer à un cas général, que je résumerais comme suit.\\

Lorsqu'on souhaite utiliser une méthode $GLM$, on a donc plusieurs cas :

\begin{itemize}
    \itemcirc soit les réalisations ${(y_i)}_{i\in\llbracket1,n\rrbracket}$ de la loi postulée $Y$ peuvent légitimement être considérées comme indépendantes, auquel cas on peut utiliser le cadre $GLM$
    \itemcirc soit les réalisations ${(y_i)}_{i\in\llbracket1,n\rrbracket}$ de la loi postulée $Y$ ne peuvent pas être supposées comme indépendantes, et on doit :
    \begin{enumerate}
        \item soit changer les données de sortes qu'elles puissent être considérées comme des tirages de lois indépendantes $\mathbb{P}_Y$, afin de se ramener au cadre $GLM$
        \item soit changer la modélisation $GLM$ standard (par exemple certaines méthodes utilisent un cadre du $GLM$ modifié où est inclus un terme de corrélation "liant" de force des individus $i$)
        \item soit trouver une autre grandeur $\tilde{Y}$ modélisant ce même phénomène qu'on souhaite étudier, mais dont on puisse affirmer que les données puissent être considérées comme des tirages des lois indépendantes $\mathbb{P}_{\tilde{Y}}$
        \item soit abandonner la modélisation $GLM$ pour le problème en question.
    \end{enumerate}
\end{itemize}

Les options 3) et 4) constituent un changement d'objet ou de méthode. L'option 1) constitue une solution de facilité mais qui nous ferait perdre une grande quantité de nos données, dont la diversité fonde grandement l'intérêt de notre méthode. Nous avons donc d'abord envisagé l'option 2).
\par Celle-ci nous permettrait d'inclure un terme de corrélation entre les données spatialement proches. Après avoir réalisé une recherche bibliographique sur le sujet, se sont présentées à les méthodes dites autoregressives. L'article \textit{Spatial autoregressive models for statistical inference from ecological data}, paru dans la revue \textit{Ecological Monographs} en 2018\cite{Ver Hoef 2018}, propose une des synthèses les plus complètes de ces modèles, en divisant la présentation entre modèles dits $SAR$ (\textit{Simultaneous AutoregRessive Models}) et $CAR$ (\textit{Conditional AutoregRessive Models}).
\par Le coeur des modèles est de déterminer une matrice de voisinage $W$ et de définir une matrice de covariance en fonction. La matrice $W$ est de taille carrée, de dimension égale au nombre d'individus $n$. L'évaluation de la distance, et donc de l'impact de la valeur de la variable d'un point $i$ pour la valeur de cette même variable en $i'$ est défini avec cette notion de voisinage. Pour notre problème, nous avons préféré laisser de côté ces méthodes, pour plusieurs raisons.
\par La taille de nos données est trop importante. Nous avons près des dizaines de millions de points. Ne serait-ce que de définir une matrice d'une telle taille est souvent bien trop grand pour la puissance de nos machines. De plus nos données sont géoréférencées précisément, il m'apparaît peu pertinent d'utiliser un modèle de type $CAR$ ou $SAR$ qui semble par construction avoir été pensé pour des données régionalisées, à l'instar de l'exemple de l'article qui est celui de la présence de phoques dans une partie de l'Alaska, découpée en 463 régions avec 3 degrés de voisinage. Le calcul précis de distance $d(\left(x,y\right),\left(x',y'\right))$ peut être réalisé sur nos données (il n'est toutefois pas totalement trivial puisque pour les longues distances il faut prendre en compte la courbure terrestre). Ces arguments principaux nous ont plutôt orientés vers les méthodes dites géostatistiques.
\par En dépit de son nom, la géostatistique ne peut pas être considérée comme une branche de la statistique. La plupart des statisticiens ne sont pas formés à la géostatistique. La prise en compte de l'ordonnancement spatial des données change pour ainsi dire tout. Là où l'immense majorité des méthodes statistiques sont basées sur l'indépendance et le caractère interchangeable des données d'un échantillon, le point de départ de la géostatistique est que les données influent les unes sur les autres dans une certaine mesure. Ma recherche bibliographique m'a amené à lire plein de choses intéressantes mais il n'y a semble-t-il pas de méthode implémentées permettant d'utiliser simplement un modèle $GLM$ tout en calibrant une influence des données les unes sur les autres. Il apparaît clairement que les $GLM$ sont des méthodes construites pour calibrer les coefficients de l'équation \ref{produit_des_densites}, et qu'il n'y a pas de méthode de référence solidement éprouvée théoriquement et numériquement pour une alternative spatiale en deux dimensions.\\

\par Nous avons donc finalement opté pour l'option 1), c'est-à-dire utiliser comme données explicatives des réalisations ${(y_i)}_{i\in\llbracket1,n\rrbracket}$ de la loi postulée $Y$ peuvent légitimement être considérées comme indépendantes. Pour ce faire nous avons choisi d'utiliser un sous-ensemble de nos données ${(y_i)}_{i\in\llbracket1,n_0\rrbracket}$ de sorte que les réalisations de $Y$ puissent être supposées indépendantes les unes des autres. Cela revient à sélectionner uniquement des points suffisamment éloignés et à supposer qu'à partir d'une certaine distance, "ils ne s'influencent pas". Cette solution nous fait perdre la diversité de nos données.

\subsubsection{Definition of a cell width}
au terme de cette section, on définit une taille de cellule
\par [définition empirique de cette distance, à défaut de variogrammes]

\par Cette étape de sous-échantillonage peut paraître immédiate, mais elle ne l'est pas. cf section suivante

\subsubsection{Data subsampling process}

\par Pour ne conserver qu'une donnée tous les $x$ km, il existe des méthodes pré-implémentées à base de \textit{buffers}, selon le jargon informatique. Toutefois beaucoup de ces méthodes reposent sur des calculs de matrices de distance. Une matrice de distance entre $n$ points nécessitent $n^2$ calculs, puisqu'il faut calculer la distance de chaque point avec tous les autres points. C'est-à-dire que pour $10^4$ points, cela représente $10^8$ calculs, et pour l'ordre de grandeur de nos données, de plusieurs millions, cela revient au calcul et stockage d'une matrice à $10^12$ coefficients ce qui est trop coûteux pour nos machines et impossible à calculer. Nous pouvons toutefois utiliser des ruses pour ne calculer les distances que vis-à-vis des points pouvant être raisonnablement proches (et pas sur des points à $100 000$ km). Toutefois pour savoir si les points sont proches, il faut justement calculer leur distance. Pour sous-échantilloner, il faut donc utiliser une sous-méthode, elle aurait pu être à base de sous-clusterage automatique [citer le truc de Witold regressionTree?]. Nous avons opté pour l'idée consistant à placer une grille sur les données et à ne conserver que des données espacées de la taille de la cellule. Conserver un point par cellule ne suffit pas pour s'assurer que les points sont à une distance $R$ puisqu'on peut avoir deux points de par et d'autres d'une frontière. Nous avons donc conservé aléatoirement un point

Finalement, quitte à utiliser une méthode déjà implémentée mais compliquée à mettre en place sous-échantilloner, à complexité égale, nous nous sommes dits que c'était aussi bien que nous l'implémentions nous-même. Nous avons ainsi le package $terra$ et procédé comme suit.

\begin{figure}[htpb]%
    \centering
    \subfloat[\centering Définition d'une grille]{{\includegraphics[width=5cm]{Images/grid1.png}}\label{subfig:subsampling:A}}
    \subfloat[\centering Sélection des cases impaires]{{\includegraphics[width=5cm]{Images/grid2.png}}\label{subfig:subsampling:B}}
    \subfloat[\centering Sélection d'un point par case]{{\includegraphics[width=5cm]{Images/grid4.png}}\label{subfig:subsampling:C}}
    \caption{Subsampling process}
    \label{fig:subsampling}%
\end{figure}

\par Ce processus peut paraître simple mais il est en fait compliqué. En effet, en transformant les données vectorielles en raster, on n'a pas l'information que tel point est dans "la case (i,j)". Sans cette information, il est compliqué de sélectionner un point par case. Nous y sommes quand même parvenu. Voici le pseudo-code nous ayant permis d'obtenir cela.

\begin{itemize}
    \itemcirc On récupère le tableau complet avec pour chaque point géoréférencé le nom de l'écorégion.
    \itemcirc On crée une fonction qui renvoie, pour un nombre de colonnes et lignes fixées, une liste correspondant au tableau dont on aurait mis les lignes les unes à la suite des autres, avec TRUE si la colonne et la ligne initiales sont impaires et FALSE sinon. Cela correspond à l'ordre utilisé dans la fonction \textit{rasterize} de \textit{terra}.
    \itemcirc On définit une taille de case. (cell = 10**4 mètres)
    \itemcirc Pour chaque écorégion, on définit les actions qui suivent.
    
\begin{itemize}
    \itemcirc On sélectonne tous les points géoréférencés de l'écorégion dans une sous-tableau;
    \itemcirc On crée un raster new\_spatvector à partir de ce sous-tableau, proj = WS84
    \itemcirc On récupère l'extent, et à partir de cell on calcule le nombre de lignes et de colonnes du raster.
    \itemcirc On crée un raster y vide avec ce nombre de lignes et de colonnes.
    \itemcirc Grâce à la fonction précédemment définit, on récupère l'information de savoir si TRUE ou FALSE pour chaque cellule du raster dont on n'a plus l'information des lignes ou des colonnes, et on la rajoute à y.
    \itemcirc On récupère dans un autre raster z un sample de 1 point géoréférencé par case de new\_spatvector.
    \itemcirc On crée une table intermédiaire avec les TRUE-FALSE de y, les coordonnées des x,y center\_cell des centres des cases de y, et les valeurs samplées par case de z.
    \itemcirc On fusionne dans trsf\_data cette table-intermédiaire avec le tableau du début avec la jointure sur la clef attribuant un numéro à chaque point géoréférencé commune au tableau du début et à z. On recolle ainsi le numéro de la clef à chaque point échantillonné.
    \itemcirc On peut ainsi conserver uniquement les points TRUE avec leur clef d'origine.
    \itemcirc On en profite pour exclure la dizaine de points qui s'éloigne de trop de leur center-cell lors de l'opération rasterize. (les points dans la mer)
    \itemcirc  On peut sauvegarder l'échantillon finale sous forme de tableau .RDS ou de fichier vecteur pour QGIS .geojson.
\end{itemize}
\end{itemize}

Nous sommes ainsi passés de la figure \ref{subfig:subsampling:A} à la figure \ref{subfig:subsampling:C}.

\subsubsection{Subsampling effects}\label{section_subsampling_effect}

\par Drastic data loss + change in histograms forms\\

\par Noter ici l'effet du sampling sur les histogrammes.

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.2]{}
\caption{Un histogramme des données rh98 pre and post samplees}
\label{fig:myfig}
\end{figure}

\par Pour résumer les parties \ref{section_independance_problem} à \ref{section_subsampling_effect}, le problème d'indépendance des données \textit{rh98} et \textit{canopy\_cover} nous a amené à considérer plusieurs solutions. Après une recherche bibliographique, nous avons délaissé les méthodes autogressives qui ne nous semblaient ontologiquement pas adaptées, tant par l'utilisation de matrice de voisinage que pour la taille et le type de nos données. A défaut d'une approche géostatistique simple que nous n'avons pas trouvée, nous avons choisi de sous-échantilloner nos données. Cela présentait divers difficultés que nous avons surmontées. [Noter ici l'effet du sampling sur les histogrammes.]

\subsubsection{Application des $GLM$ aux données sous-échantillonnées}

cadre de travail : dossiers informatiques etc pour s'y retrouver\\
après que dire...?

\subsection{Full interaction diagram estimation}
\subsubsection{A new interaction diagram}
effet canopee + pluie -> grass biomass -> feu

\newpage
\section{Results}
\newpage
\section{Discussion}
\newpage
\section{Supplementary material}
\label{section_supplementary_material}
\pagenumbering{Roman}

\subsection{Missing data table}

[colorier certaines colonnes avec le package machin]\\
peut-être virer la colonne écorégion et dire avec une phrase que toutes sont renseignées\\
mettre le nombre de données à la place peut-être une bonne idée\\

\begin{table}[!ht]
    \centering
    \begin{tiny}
    \begin{tabular}{l|l|l|l|l|l|l|l|l|l|l|l|l}
         & "x" & "y" & "rh98" & "canopy\_cover" & "fire\_freq" & "mean\_precip" & "cv\_rainfall" & "eff\_rainfall" & "mean\_temp" & "temp\_range" & "ecoregion" & "missing" \\ \hline
        "Angolan\_mopane" & 0 & 0 & 0 & 0.1 & 0.65 & 0.17 & 0.08 & 0 & 0.08 & 0.08 & 0 & 0.78 \\ \hline
        "Angolan\_wet" & 0 & 0 & 0 & 0.04 & 0.14 & 0.01 & 0 & 0.04 & 0 & 0.02 & 0 & 0.18 \\ \hline
        "Campos\_Rupestres" & 0 & 0 & 0 & 0.06 & 0.88 & 0 & 0 & 0 & 0 & 0 & 0 & 0.88 \\ \hline
        "Central\_bushveld" & 0 & 0 & 0 & 0.21 & 0.66 & 0.07 & 0.07 & 0.07 & 0.07 & 0.07 & 0 & 0.74 \\ \hline
        "Central\_Zambezian" & 0 & 0 & 0 & 0.02 & 0.05 & 0 & 0 & 0 & 0 & 0 & 0 & 0.06 \\ \hline
        "Drakensberg\_Escarpment" & 0 & 0 & 0 & 0.43 & 0.61 & 0.24 & 0.24 & 0 & 0.24 & 0.24 & 0 & 0.87 \\ \hline
        "Drakensberg\_grasslands" & 0 & 0 & 0 & 0.45 & 0.49 & 0 & 0 & 0 & 0.44 & 0.44 & 0 & 0.76 \\ \hline
        "Dry\_miombo" & 0 & 0 & 0 & 0.05 & 0.12 & 0 & 0.03 & 0 & 0 & 0 & 0 & 0.18 \\ \hline
        "East\_Sudanian" & 0 & 0 & 0 & 0.11 & 0.09 & 0 & 0 & 0 & 0 & 0 & 0 & 0.2 \\ \hline
        "Guinean\_forest-savanna" & 0 & 0 & 0 & 0.04 & 0.22 & 0.03 & 0.04 & 0.03 & 0.03 & 0.02 & 0 & 0.25 \\ \hline
        "Horn\_of" & 0 & 0 & 0 & 0.03 & 1 & 0 & 0 & 0.21 & 0.21 & 0.21 & 0 & 1 \\ \hline
        "Itigi-Sumbu\_thicket" & 0 & 0 & 0 & 0 & 0.86 & 0 & 0 & 0 & 0 & 0 & 0 & 0.86 \\ \hline
        "Kalahari\_Acacia" & 0 & 0 & 0 & 0.01 & 0.39 & 0 & 0 & 0 & 0 & 0 & 0 & 0.39 \\ \hline
        "Mandara\_Plateau" & 0 & 0 & 0 & 0.02 & 0.4 & 0 & 0 & 0 & 0 & 0 & 0 & 0.42 \\ \hline
        "Masai\_xeric" & 0 & 0 & 0 & 0.4 & 0.98 & 0 & 0 & 0.07 & 0 & 0 & 0 & 0.99 \\ \hline
        "Northern\_Congolian" & 0 & 0 & 0 & 0.15 & 0.28 & 0.14 & 0.14 & 0.14 & 0.14 & 0 & 0 & 0.29 \\ \hline
        "Sahelian\_Acacia" & 0 & 0 & 0 & 0.04 & 0.89 & 0.02 & 0.02 & 0.02 & 0.01 & 0.02 & 0 & 0.89 \\ \hline
        "Serengeti\_volcanic" & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 1 \\ \hline
        "Southern\_Congolian" & 0 & 0 & 0 & 0.01 & 0.06 & 0 & 0 & 0 & 0 & 0 & 0 & 0.07 \\ \hline
        "West\_Sudanian" & 0 & 0 & 0 & 0.01 & 0.29 & 0 & 0 & 0.01 & 0 & 0.04 & 0 & 0.31 \\ \hline
        "Western\_Congolian" & 0 & 0 & 0 & 0.14 & 0.1 & 0 & 0 & 0 & 0 & 0 & 0 & 0.22 \\ \hline
        "Zambezian-Limpopo\_mixed" & 0 & 0 & 0 & 0.13 & 0.35 & 0 & 0 & 0 & 0 & 0 & 0 & 0.42 \\ \hline
        "Zambezian\_Baikiaea" & 0 & 0 & 0 & 0.01 & 0.24 & 0 & 0 & 0 & 0 & 0 & 0 & 0.25 \\ \hline
        "Zambezian\_mopane" & 0 & 0 & 0 & 0.2 & 0.57 & 0 & 0.02 & 0.07 & 0.04 & 0.04 & 0 & 0.62 \\
    \end{tabular}
    \end{tiny}
    \caption{Missing data table}
    \label{fig:missing_data_table}
\end{table}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\subsection{Fire frequency missing data through space}\label{section_NA_fire_freq_through_space}

\begin{figure}[htpb!]%
    \centering

%\vspace{-2\baselineskip}
    \subfloat[\centering Sahelian]{{\includegraphics[scale=0.2]{Images/Sahelian_Acacia _fire_freq.png}}\label{subfig:Sahelian_fire_freq}}
    \subfloat[\centering Sahelian]{{\includegraphics[scale=0.2]{Images/Sahelian_Acacia _fire_freq_NA.png}
}\label{subfig:Sahelian_fire_freq_NA}}

    \subfloat[\centering Sudanian]{{\includegraphics[scale=0.2]{Images/West_Sudanian _fire_freq.png}}\label{subfig:Sudanian_fire_freq}}
    \subfloat[\centering Sudanian]{{\includegraphics[scale=0.2]{Images/West_Sudanian _fire_freq_NA.png}
}\label{subfig:Sudanian_fire_freq_NA}}
%\vspace{-2\baselineskip}

\subfloat[\centering Guinean]{
    {\includegraphics[scale=0.2]{Images/Guinean_forest-savanna _fire_freq.png}}\label{subfig:Guinean_fire_freq}}
    \subfloat[\centering Guinean]{{\includegraphics[scale=0.2]{Images/Guinean_forest-savanna _fire_freq_NA.png}
}\label{subfig:Guinean_fire_freq_NA}}
\caption{Fire frequency GEDI data over those three ercoregions}
\label{fig:fire_freq_na}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\subsection{Sahelian and Sudanian histograms}
\label{section_sahelian_sudanian_histograms}

\begin{figure}[htbp!]
\centering
\includegraphics[scale=0.8]{Images/hist_Sahelian_Acacia.png}
\caption{Sahelian histograms}
\label{fig:hist_Sahelian}
\end{figure}

%\vspace{-2\baselineskip}

\begin{figure}[htbp!]
\centering
\includegraphics[scale=0.8]{Images/hist_West_Sudanian.png}
\caption{Sudanian histograms}
\label{fig:hist_Sudanian}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\subsection{Correlation matrices}\label{annexe_matrices_correlation}

Avec remplacement des NA fire\_freq par 0.

%\begin{center}
%\includegraphics[scale=1]{matrices_correlations/all_data.png}
%\end{center}

\begin{center}
\includegraphics[scale=0.6]{matrices_correlations/Guinean_forest-savanna.png}
\end{center}

\begin{center}
\includegraphics[scale=0.6]{matrices_correlations/West_Sudanian.png}
\end{center}

\begin{center}
\includegraphics[scale=0.6]{matrices_correlations/Sahelian_Acacia.png}
\end{center}

\printbibliography


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage 
% References
\printbibliography

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage 

\end{document}

